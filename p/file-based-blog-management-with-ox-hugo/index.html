<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>File-based Blog Management with ox-hugo &#183; Fang Deng</title><meta name=description content="Interesting content."><meta name=keywords content="Interesting keywords."><link rel=stylesheet href=https://peromage.github.io/css/skeria.css><link rel=stylesheet href=https://peromage.github.io/css/font.awesome.6.1.2.all.min.css></head><body><div class=topbar><div class=topbar-sticky><a href=https://peromage.github.io/ style=text-decoration:none><h1>(->> truth make (desire))</h1></a><span class=lead>May the sapphire star light your way✨</span>
<span class=topbar-nav><p><span class=topbar-nav-item><a href=https://peromage.github.io/categories>Categories</a></span>
<span class=topbar-nav-item><a href=https://peromage.github.io/tags>Tags</a></span>
<span class=topbar-nav-item><a href=https://peromage.github.io/search>Search</a></span>
<span class=topbar-nav-item><a href=https://peromage.github.io/about>About</a></span></p></span></div></div><div class="content container"><div class=post><h1 class=post-title>File-based Blog Management with ox-hugo</h1><span class=post-date>Nov 15, 2022
&nbsp;&#183;&nbsp; 2 minute read
&nbsp;&#183;&nbsp;
<a class=label href=https://peromage.github.io/emacs>emacs</a></span><h2 id=background>Background</h2><p>I previously wrote a <a href=/p/use-org-mode-to-manage-my-blog/>post</a> about managing blog posts with ox-hugo in org mode. I used to follow the recommendation to keep posts under org subtrees. As posts grew, I found that the opening speed is quite slow even I didn&rsquo;t have many pictures inserted. Although managing the entire site within one file does have some convenience, the slowness is something I can&rsquo;t bear.</p><p>Also I feel it a little awkward when I use the subtree style management. I always worried about if the format was correct like how many empty lines between posts or if something was accidentally changed outside of the post that I was editing. And in order to maintain the subtree structure, the actual posts have to be indented (nested), which is not what I like. There are solutions for this nested editing. I used to use <code>org-narrow-to-subtree</code> when I was editing the post and use <code>widen</code> to switch the view back. But still, I always worried about the format (please forgive OCD patient).</p><p>However, I want to continue using <code>ox-hugo</code>. It is a wonderful package indeed! Luckily, it supports <a href=https://ox-hugo.scripter.co/doc/usage/#for-only-the-one-post-per-file-flow>file-based style</a>.</p><h2 id=global-properties>Global properties</h2><p>One of the benefits that subtree style brings is you can inherit properties from the parent nodes. You can put category tags on the parent node. When creating posts under it, all posts will automatically inherit the category when they get exported. Also you can set some global org settings in the header so all posts can share it.</p><p>I want to have as much as close to this goodies when I use file-based style I created a <a href=https://github.com/peromage/peromage.github.io/blob/master/blog/setup.conf>setup.conf file</a> as the global settings.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-org data-lang=org><span style=display:flex><span><span style=color:#8f5902;font-style:italic># -*- mode: org; -*-</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># setup.conf</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Author.
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#+author</span><span style=color:#8f5902;font-style:italic>: John Doe</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>On file open.
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#+startup</span><span style=color:#8f5902;font-style:italic>: fold</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#+startup</span><span style=color:#8f5902;font-style:italic>: indent</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#+startup</span><span style=color:#8f5902;font-style:italic>: logdone</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#+startup</span><span style=color:#8f5902;font-style:italic>: logdrawer</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Todo states.
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#+seq_todo</span><span style=color:#8f5902;font-style:italic>: DRAFT(d) | CREATED(c!) PUBLISHED(p!)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Categories.
</span></span><span style=display:flex><span>This is mainly for subtree-based export style.
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#+tags</span><span style=color:#8f5902;font-style:italic>: @emacs @coding @linux @tech @ramble @折腾</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Posts under categories are expected to read this so the path is relative to the post files.
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#+hugo_base_dir</span><span style=color:#8f5902;font-style:italic>: ../../hugo</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Default section.
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#+hugo_section</span><span style=color:#8f5902;font-style:italic>: blog</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Date and time.
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#+hugo_auto_set_lastmod</span><span style=color:#8f5902;font-style:italic>: t</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#+options</span><span style=color:#8f5902;font-style:italic>: d:t</span>
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>When starting a new post, simple use it as the setup file. The editing experience will be consistent. If some settings needs to be overridden in this post specifically, put them before the <code>#+setupfile</code> directive (same settings only the first occurrence gets applied).</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-org data-lang=org><span style=display:flex><span><span style=color:#8f5902;font-style:italic># new-post.org</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#+startup</span><span style=color:#8f5902;font-style:italic>: nofold</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#+setupfile</span><span style=color:#8f5902;font-style:italic>: ./setup.conf</span>
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>Something needs to be noticed is, as you can see, I&rsquo;ve put some descriptions in the config file. Don&rsquo;t worry. Only org directives will be read when used by <code>#+setupfile</code>. This is great because it gives you flexibility to keep comments of those settings in case you forget in the future.</p><h2 id=inherit-category>Inherit category</h2><p>I also want to have the ability to inherit category so I don&rsquo;t need to manually type it. Indeed I sometimes forget what categories I have if I don&rsquo;t write blog for a while.</p><p>To achieve this, I created a few subfolders as categories and put posts under them respectively. Then I created another <code>setup.conf</code> under each category folder with the settings.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-org data-lang=org><span style=display:flex><span><span style=color:#8f5902;font-style:italic># emacs/setup.conf</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#+hugo_categories</span><span style=color:#8f5902;font-style:italic>: emacs</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#+setupfile</span><span style=color:#8f5902;font-style:italic>: ../setup.conf</span>
</span></span></code></pre></div><p>Don&rsquo;t doubt it. <code>#+setupfile</code> can be used recursively! Fantastic! Now new posts under emacs category just need to include this file in their headers and they will be assigned to this category automatically during export.</p><h2 id=hugo-pages>Hugo pages</h2><p>I actually use <code>ox-hugo</code> in a hybrid way. For navigation pages, I continue managing <a href=https://github.com/peromage/peromage.github.io/blob/master/blog/hugo-pages.org>them</a> with subtrees and overriding settings if it&rsquo;s different from the global with heading properties.</p><h2 id=export-script>Export script</h2><p>I used to use a shell script to export. Just realized that Emacs had script support since version 22 so I created a <a href=https://github.com/peromage/peromage.github.io/blob/master/blog/ox-hugo-export.el>Elisp script</a> for this purpose.</p><h2 id=similar-solution>Similar solution</h2><p>This can also be achieved by using Emacs local variable but it will ask you to confirm if those variables are safe if you don&rsquo;t persist the settings. I find it quite annoying especially used with CI. It will most likely break CI if you are not careful.</p><p>However, this is more convenience than the header method when you have nested folder structures. It can calculate the Hugo base path when the variables get evaluated.</p><pre tabindex=0><code class=language-lisp-data data-lang=lisp-data>((org-mode . ((eval . (setq org-hugo-base-dir (locate-dominating-file default-directory &#34;.git&#34;))))))
</code></pre><p>Be careful when using it with CI.</p><h2 id=folder-structure>Folder structure</h2><p>My folder structure finally looks like this.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>.
</span></span><span style=display:flex><span>├── coding
</span></span><span style=display:flex><span>│   ├── post1.org
</span></span><span style=display:flex><span>│   ├── post2.org
</span></span><span style=display:flex><span>│   ├── post3.org
</span></span><span style=display:flex><span>│   └── setup.conf
</span></span><span style=display:flex><span>├── emacs
</span></span><span style=display:flex><span>│   ├── post1.org
</span></span><span style=display:flex><span>│   ├── post2.org
</span></span><span style=display:flex><span>│   ├── post3.org
</span></span><span style=display:flex><span>│   └── setup.conf
</span></span><span style=display:flex><span>├── linux
</span></span><span style=display:flex><span>│   ├── post1.org
</span></span><span style=display:flex><span>│   ├── post2.org
</span></span><span style=display:flex><span>│   ├── post3.org
</span></span><span style=display:flex><span>│   └── setup.conf
</span></span><span style=display:flex><span>├── tech
</span></span><span style=display:flex><span>│   ├── post1.org
</span></span><span style=display:flex><span>│   ├── post2.org
</span></span><span style=display:flex><span>│   ├── post3.org
</span></span><span style=display:flex><span>│   └── setup.conf
</span></span><span style=display:flex><span>├── setup.conf
</span></span><span style=display:flex><span>├── hugo-pages.org
</span></span><span style=display:flex><span>└── ox-hugo-export.el
</span></span></code></pre></div><h2 id=summary>Summary</h2><p>Now I feel it much clearer. <code>ox-hugo</code> is a definitely a fantastic package. It helps me manage posts in org mode and seamlessly work with Hugo with ease.</p><p>If you haven&rsquo;t used either org mode or Hugo, I highly recommend to give them a try.</p></div></div><script src=https://peromage.github.io/js/mathjax.3.2.2.tex-svg.min.js></script><div class=bottombar><div class=bottombar-sticky><div class=icons><span class=icons-item><a href=https://github.com/peromage target=_blank><i class="fab fa-github"></i></a></span>
<span class=icons-item><a href=https://www.linkedin.com/in/fangdeng/ target=_blank><i class="fab fa-linkedin fa-1x"></i></a></span>
<span class=icons-item><a href=mailto:fang@saffyyre.com><i class="fas fa-envelope fa-1x"></i></a></span>
<span class=icons-item><a href=/gpg-pubkey.txt><i class="fas fa-key fa-1x"></i></a></span></div><div class=footer><p>&copy; 2022 Fang Deng, <a href=https://peromage.github.io/license/>License</a><br><a href=/privacy title="Privacy notice">Privacy notice</a></p></div></div></div></body></html>