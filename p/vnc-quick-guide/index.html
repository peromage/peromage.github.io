<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>VNC Quick Guide &#183;</title><meta name=description content="Interesting content."><meta name=keywords content="Interesting keywords."><link rel=stylesheet href=https://peromage.github.io/css/skeria.css><link rel=stylesheet href=https://peromage.github.io/css/font.awesome.6.1.2.all.min.css></head><body><div class=topbar><div class=topbar-sticky><a href=https://peromage.github.io/ style=text-decoration:none><h1>undefined behavior</h1></a><span class=lead>tb;dr - too boring; don&rsquo;t read</span>
<span class=topbar-nav><p><span class=topbar-nav-item><a href=https://peromage.github.io/>Recent</a>
</span><span class=topbar-nav-item><a href=https://peromage.github.io/posts>All Posts</a>
</span><span class=topbar-nav-item><a href=https://peromage.github.io/categories>Categories</a>
</span><span class=topbar-nav-item><a href=https://peromage.github.io/tags>Tags</a>
</span><span class=topbar-nav-item><a href=https://peromage.github.io/about>About</a>
</span><span class=topbar-nav-item><a href=https://peromage.github.io/search>Search</a></span></p></span></div></div><div class="content container"><div class=post><h1 class=post-title>VNC Quick Guide</h1><span class=post-date>Jun 15, 2022
&nbsp;&#183;&nbsp; 3 minute read
&nbsp;&#183;&nbsp;
<a class=label href=https://peromage.github.io/linux>linux</a></span><p>I found that every time when I try to setup VNC for remote access I always have troubles so this post serves as a note for myself.</p><p>Be aware VNC only works for X (not sure about Wayland).</p><h2 id=choose-a-vnc-server>Choose a VNC Server</h2><p>Generally I use <a href=https://tigervnc.org/>TigerVNC</a>. It&rsquo;s a fork of <em>TightVNC</em> with good performance and easy configuration.</p><p>It has two types of installations:</p><ul><li>Standalone: It creates a new X server when the client is connected. Independent from the local X server.</li><li>Scraping: It mirrors the local X server, like screen sharing.</li></ul><p>Usually they are shipped with individual packages. To install, for example, on Ubuntu</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ sudo apt install tigervnc-standalone-server
</span></span><span style=display:flex><span>$ sudo apt install tigervnc-scraping-server
</span></span></code></pre></div><p>Usually I would go with the scraping mode since open windows persist as long as the user is not logged out. And also I can quickly jump onto the physical desktop if it is needed. Unlike the standalone mode which closes all the windows when the service is stopped or restarted.</p><h2 id=standalone-server>Standalone Server</h2><p>Configuring a standalone server is fairly easy. You would only need three things: client password, server config and server startup script. They are all located under <code>$HOME/.vnc/</code>.</p><ol><li>Create the password file.</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ vncpasswd
</span></span></code></pre></div><ol><li>Create the server config file (<code>$HOME/.vnc/config</code>). A minimal configuration is shown as following.</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cfg data-lang=cfg><span style=display:flex><span><span style=color:#c4a000>geometry</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>1366x768</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>alwaysshared</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>localhost</span>
</span></span></code></pre></div><ol><li>Create the server startup script (<code>$HOME/.vnc/xstartup</code>). This is also a minimal configuration.</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#!/bin/sh
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87>unset</span> DBUS_SESSION_BUS_ADDRESS
</span></span><span style=display:flex><span>vncconfig -iconic <span style=color:#000;font-weight:700>&amp;</span>
</span></span><span style=display:flex><span>dbus-launch --exit-with-session /usr/bin/gnome-session --session<span style=color:#ce5c00;font-weight:700>=</span>ubuntu
</span></span></code></pre></div><p>Be aware that the last line <code>dbus-launch</code> is important on some distros that are shipped with default desktop environment. Without it the VNC server could not be started correctly. This is because the newly launched desktop environment tries to reuse the existing D-Bus but it&rsquo;s occupied by the local X server already. <code>dbus-launch</code> makes sure it runs in its own little world. See <code>dbus-launch</code>&rsquo;s man page for details.</p><ol><li>Start the server. Make sure the display port is not used by anyone else.</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ vncserver :1
</span></span></code></pre></div><ol><li>Connect from the client. On the remote PC:</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ssh -L 5901:localhost:5901 -t user@ip
</span></span></code></pre></div><p>The TCP port depends on the display port used to start the VNC server. The equation is like: TCP_PORT = 5900 + DISPLAY_PORT. Usually the <code>:0</code> is taken by local X server.</p><p>Use any VNC client to connect to <code>localhost:5901</code>.</p><h3 id=add-it-as-a-systemd-service>Add it as a Systemd service</h3><p>Add the service file.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cfg data-lang=cfg><span style=display:flex><span><span style=color:#8f5902;font-style:italic># $HOME/.config/systemd/user/vncserver.service</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>[Service]</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>ExecStart</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>vncserver :1</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>Restart</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>on-failure</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>[Install]</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>WantedBy</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>default.target</span>
</span></span></code></pre></div><p>Start the service.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>systemctl --user <span style=color:#204a87>enable</span> vncserver.service
</span></span><span style=display:flex><span>systemctl --user start vncserver.service
</span></span></code></pre></div><h2 id=scraping-server>Scraping Server</h2><p>Configuring a scraping server is slightly different from the standalone server but it&rsquo;s not hard.</p><ol><li>Create the password file. Same with the standalone server.</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ vncpasswd
</span></span></code></pre></div><ol><li>Start the server. This is where it&rsquo;s different from the standalone one. Since it replicates the local X server it doesn&rsquo;t need the configuration.</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ x0vncserver -rfbauth <span style=color:#000>$HOME</span>/.vnc/passwd -display :0
</span></span></code></pre></div><p>Don&rsquo;t forget to specify the password file or you&rsquo;ll not be able to connect to it.</p><ol><li>Connect from the client. Same with the standalone server. On the remote PC:</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ssh -L 5900:localhost:5900 -t user@ip
</span></span></code></pre></div><p>Local X server already uses display port <code>:0</code>. Then use any VNC client to connect to <code>localhost:5900</code>.</p><h3 id=add-it-as-a-systemd-service>Add it as a Systemd service</h3><p><strong>CAVEAT</strong>: The user must be configured to auto login, otherwise the user has to be logged in manually in order to start the service (make display <code>:0</code> ready).</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cfg data-lang=cfg><span style=display:flex><span><span style=color:#8f5902;font-style:italic># $HOME/.config/systemd/user/x0vncserver.service</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>[Service]</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>ExecStart</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>x0tigervncserver -display :0 -rfbauth %h/.vnc/passwd</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Restart when :0 is not ready</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>RestartForceExitStatus</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># General restart</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#Restart=on-failure</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>[Install]</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>WantedBy</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>default.target</span>
</span></span></code></pre></div><p>Start the service.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>systemctl --user <span style=color:#204a87>enable</span> x0vncserver.service
</span></span><span style=display:flex><span>systemctl --user start x0vncserver.service
</span></span></code></pre></div><h2 id=synonyms-of-tigervnc>Synonyms of TigerVNC</h2><p>I was confused by the TigerVNC since there are similar commands. It turned out they are the same.</p><ul><li><code>vncserver</code> -> <code>tigervncserver</code></li><li><code>vncconfig</code> -> <code>tigervncconfig</code></li><li><code>vncpasswd</code> -> <code>tigervncpasswd</code></li><li><code>x0vncserver</code> -> <code>tigerx0vncserver</code></li></ul></div></div><script src=https://peromage.github.io/js/mathjax.3.2.2.tex-svg.min.js></script><div class=bottombar><div class=bottombar-sticky><div class=icons><span class=icons-item><a href=https://github.com/peromage target=_blank><i class="fab fa-github"></i></a> </span><span class=icons-item><a href=https://www.linkedin.com/in/fangdeng/ target=_blank><i class="fab fa-linkedin fa-1x"></i></a> </span><span class=icons-item><a href=mailto:fang@elfang.com><i class="fas fa-envelope fa-1x"></i></a> </span><span class=icons-item><a href=/me.pub><i class="fas fa-key fa-1x"></i></a></span></div><div class=footer><p>&copy; 2025 , <a href=https://peromage.github.io/license/>License</a><br><a href=/privacy title="Privacy notice">Privacy notice</a></p></div></div></div></body></html>