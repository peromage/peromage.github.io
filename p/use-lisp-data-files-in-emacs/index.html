<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>Use lisp-data Files in Emacs &#183; </title><meta name=description content="Interesting content."><meta name=keywords content="Interesting keywords."><link rel=stylesheet href=https://peromage.github.io/css/skeria.css><link rel=stylesheet href=https://peromage.github.io/css/font.awesome.6.1.2.all.min.css></head><body><div class=topbar><div class=topbar-sticky><a href=https://peromage.github.io/ style=text-decoration:none><h1>undefined behavior</h1></a><span class=lead>tb;dr - too boring; don&rsquo;t read</span>
<span class=topbar-nav><p><span class=topbar-nav-item><a href=https://peromage.github.io/>Recent</a>
</span><span class=topbar-nav-item><a href=https://peromage.github.io/posts>All Posts</a>
</span><span class=topbar-nav-item><a href=https://peromage.github.io/categories>Categories</a>
</span><span class=topbar-nav-item><a href=https://peromage.github.io/tags>Tags</a>
</span><span class=topbar-nav-item><a href=https://peromage.github.io/about>About</a>
</span><span class=topbar-nav-item><a href=https://peromage.github.io/search>Search</a></span></p></span></div></div><div class="content container"><div class=post><h1 class=post-title>Use lisp-data Files in Emacs</h1><span class=post-date>Nov 14, 2022
&nbsp;&#183;&nbsp; 2 minute read
&nbsp;&#183;&nbsp;
<a class=label href=https://peromage.github.io/emacs>emacs</a></span><p>I found that there were few posts mentioning about using <code>lisp-data</code> files. However, it seems to be used widely in various packages.</p><p><a href=https://www.gnu.org/software/emacs/manual/html_node/elisp/Read-and-Print.html>Emacs manumal</a> has a very detailed description of how to read and write lisp objects. In this post I&rsquo;ll mainly demonstrate one specific use case.</p><h2 id=read-from-file>Read from file</h2><p>The biggest challenge is to parse file content to Lisp lists. After a quick search with <code>describe-function</code>, <code>read</code> function is able to perfectly handle it in this case.</p><p>Suppose we have a <code>lisp-data</code> file named <code>mydata</code> with the content below.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cat <span style=color:#4e9a06>&lt;&lt;EOF &gt;&gt;mydata
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>;;; mydata -*- lisp-data -*-
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>((&#34;~/repo/peromage.github.io/&#34;)
</span></span></span><span style=display:flex><span><span style=color:#4e9a06> (&#34;~/.emacs.d/&#34;)
</span></span></span><span style=display:flex><span><span style=color:#4e9a06> (&#34;~/some/random/place&#34;))
</span></span></span><span style=display:flex><span><span style=color:#4e9a06> EOF</span>
</span></span></code></pre></div><p>When we read it, we should read the whole file as a string first and then pass it to <code>read</code> function. The easiest way is to use <code>with-temp-buffer</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87>setq</span> <span style=color:#000>data</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>read</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87>with-temp-buffer</span>
</span></span><span style=display:flex><span>		   <span style=color:#000;font-weight:700>(</span><span style=color:#000>insert-file-contents</span> <span style=color:#4e9a06>&#34;mydata&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>		   <span style=color:#000;font-weight:700>(</span><span style=color:#000>buffer-string</span><span style=color:#000;font-weight:700>))))</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>(</span><span style=color:#000>print</span> <span style=color:#000>data</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>(</span><span style=color:#000>print</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>nth</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000>data</span><span style=color:#000;font-weight:700>))</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>
</span></span><span style=display:flex><span>((&#34;~/repo/peromage.github.io/&#34;) (&#34;~/.emacs.d/&#34;) (&#34;~/some/random/place&#34;))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(&#34;~/.emacs.d/&#34;)
</span></span></code></pre></div><h2 id=write-to-file>Write to file</h2><p>Opposite to <code>read</code>, to write to file in format that <code>read</code> understands, use <code>print</code> or <code>prin1</code>. Unlike <code>princ</code> which outputs something that human readable, like removing double quotes for string, these two functions will keep the original data format.</p><p>Suppose there is a list that we want to save to a file.</p><p></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87>setq</span> <span style=color:#000>data</span> <span style=color:#ce5c00;font-weight:700>&#39;</span><span style=color:#000;font-weight:700>((</span><span style=color:#4e9a06>&#34;foo&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>	     <span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;bar&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>	     <span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;baz&#34;</span><span style=color:#000;font-weight:700>)))</span>
</span></span></code></pre></div><p>To write to a file.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87>with-temp-file</span> <span style=color:#4e9a06>&#34;saved_data&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>(</span><span style=color:#000>insert</span> <span style=color:#4e9a06>&#34;;;; saved_data -*- lisp-data -*-\n&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>(</span><span style=color:#000>print</span> <span style=color:#000>data</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>current-buffer</span><span style=color:#000;font-weight:700>)))</span>
</span></span></code></pre></div><p>Check the out file.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cat saved_data
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>;;; mydata -*- lisp-data -*-
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>((&#34;foo&#34;) (&#34;bar&#34;) (&#34;baz&#34;))
</span></span></code></pre></div><p>Nice.</p></div></div><script src=https://peromage.github.io/js/mathjax.3.2.2.tex-svg.min.js></script><div class=bottombar><div class=bottombar-sticky><div class=icons><span class=icons-item><a href=https://github.com/peromage target=_blank><i class="fab fa-github"></i></a> </span><span class=icons-item><a href=https://www.linkedin.com/in/fangdeng/ target=_blank><i class="fab fa-linkedin fa-1x"></i></a> </span><span class=icons-item><a href=mailto:fang@elfang.com><i class="fas fa-envelope fa-1x"></i></a> </span><span class=icons-item><a href=/me.pub><i class="fas fa-key fa-1x"></i></a></span></div><div class=footer><p>&copy; 2025 , <a href=https://peromage.github.io/license/>License</a><br><a href=/privacy title="Privacy notice">Privacy notice</a></p></div></div></div></body></html>