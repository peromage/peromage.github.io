<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us><head><meta name=generator content="Hugo 0.148.2"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>undefined behavior &#183;</title><meta name=description content="Interesting content."><meta name=keywords content="Interesting keywords."><link rel=stylesheet href=https://peromage.github.io/css/skeria.css><link rel=stylesheet href=https://peromage.github.io/css/font.awesome.6.1.2.all.min.css></head><body><div class=topbar><div class=topbar-sticky><a href=https://peromage.github.io/ style=text-decoration:none><h1>undefined behavior</h1></a><span class=lead>tb;dr - too boring; don&rsquo;t read</span>
<span class=topbar-nav><p><span class=topbar-nav-item><a href=https://peromage.github.io/>Recent</a>
</span><span class=topbar-nav-item><a href=https://peromage.github.io/posts>All Posts</a>
</span><span class=topbar-nav-item><a href=https://peromage.github.io/categories>Categories</a>
</span><span class=topbar-nav-item><a href=https://peromage.github.io/tags>Tags</a>
</span><span class=topbar-nav-item><a href=https://peromage.github.io/about>About</a>
</span><span class=topbar-nav-item><a href=https://peromage.github.io/search>Search</a></span></p></span></div></div><div class="content container"><div class=posts><div class=post><h1 class=post-title><a href=https://peromage.github.io/p/setup-windows-to-go-in-a-virtual-disk/>Setup Windows To Go in a Virtual Disk</a></h1><span class=post-date>Mar 13, 2024
&nbsp;&#183;&nbsp; 7 minute read
&nbsp;&#183;&nbsp;
<a class=label href=https://peromage.github.io/linux>linux</a></span><h2 id=ramble>Ramble</h2><p>It looks like I had a lot stories about this Windows boot setup. I figure this post would be the last one I write about it since this is the most commonly used case I have so far.</p><p>So I got a Steam Deck last year. It&rsquo;s pretty handy to use it as a mini PC in case I don&rsquo;t have one in hands. However, there are still things exclusive on Windows but I don&rsquo;t want to mess up with the internal SSD to dual-boot just for this temporary need.</p><a href=https://peromage.github.io/p/setup-windows-to-go-in-a-virtual-disk/>&nbsp;Read on &mldr;</a></div><div class=post><h1 class=post-title><a href=https://peromage.github.io/p/perl-quick-reference/>Perl Quick Reference</a></h1><span class=post-date>Nov 13, 2023
&nbsp;&#183;&nbsp; 19 minute read
&nbsp;&#183;&nbsp;
<a class=label href=https://peromage.github.io/coding>coding</a></span><h2 id=preface>Preface</h2><p>Perl is a powerful tool to handle text processing. However, the learning curve might be steep due to some unusual syntax. I find myself even need to revisit the doc sometimes if I don&rsquo;t use it often, so this post I&rsquo;ll write down some commonly used patterns when it comes to text processing. That said this post is updated from time to time so remember to come back!</p><p>When used as a command line tool, <code>perl</code> is powerful enough to replace traditional text processing tools like <code>sed</code>, <code>awk</code>, <code>grep</code>, <code>tr</code> etc.. Actually using <code>perl</code> instead of <code>grep</code> and <code>tr</code> might be a little overkill in most cases but the functionalities of <code>sed</code> and <code>awk</code> can be almost replaced. I recommend someone who starts learning text processing and regex to start with Perl. The reasons are:</p><a href=https://peromage.github.io/p/perl-quick-reference/>&nbsp;Read on &mldr;</a></div><div class=post><h1 class=post-title><a href=https://peromage.github.io/p/moving-from-arch-linux-to-nixos/>Moving from Arch Linux to NixOS</a></h1><span class=post-date>Oct 29, 2023
&nbsp;&#183;&nbsp; 6 minute read
&nbsp;&#183;&nbsp;
<a class=label href=https://peromage.github.io/linux>linux</a></span><p>I&rsquo;ve been learning Nix for a while and using the Nix package manager on my work desktop that runs Ubuntu. However, I did not use the NixOS on my personal laptop because I thought I might put a lot effort after work to set it up, which I didn&rsquo;t really want to. Until recent, the Arch dependencies broke again and I felt it kinda suck to fix those issues so I decided to give Nix a try. To my suprise, the installation process is way simpler than I expected.</p><a href=https://peromage.github.io/p/moving-from-arch-linux-to-nixos/>&nbsp;Read on &mldr;</a></div><div class=post><h1 class=post-title><a href=https://peromage.github.io/p/ansi-escape-code-collection/>ANSI Escape Code Collection</a></h1><span class=post-date>Aug 27, 2023
&nbsp;&#183;&nbsp; 5 minute read
&nbsp;&#183;&nbsp;
<a class=label href=https://peromage.github.io/software>software</a></span><p>The information in this collection is from Internet, which is collected for my personal convenience.</p><h2 id=csi-sequences>CSI sequences</h2><table><thead><tr><th>Code</th><th>Name</th><th>Effect</th></tr></thead><tbody><tr><td>CSI n A</td><td>CUU – Cursor Up</td><td>Moves the cursor n (default 1) cells in the given direction. If the cursor is already at the edge of the screen, this has no effect.</td></tr><tr><td>CSI n B</td><td>CUD – Cursor Down</td><td></td></tr><tr><td>CSI n C</td><td>CUF – Cursor Forward</td><td></td></tr><tr><td>CSI n D</td><td>CUB – Cursor Back</td><td></td></tr><tr><td>CSI n E</td><td>CNL – Cursor Next Line</td><td>Moves cursor to beginning of the line n (default 1) lines down. (not ANSI.SYS)</td></tr><tr><td>CSI n F</td><td>CPL – Cursor Previous Line</td><td>Moves cursor to beginning of the line n (default 1) lines up. (not ANSI.SYS)</td></tr><tr><td>CSI n G</td><td>CHA – Cursor Horizontal Absolute</td><td>Moves the cursor to column n (default 1). (not ANSI.SYS)</td></tr><tr><td>CSI n ; m H</td><td>CUP – Cursor Position</td><td>Moves the cursor to row n, column m. The values are 1-based, and default to 1 (top left corner) if omitted. A sequence such as CSI ;5H is a synonym for CSI 1;5H as well as CSI 17;H is the same as CSI 17H and CSI 17;1H</td></tr><tr><td>CSI n J</td><td>ED – Erase in Display</td><td>Clears part of the screen. If n is 0 (or missing), clear from cursor to end of screen. If n is 1, clear from cursor to beginning of the screen. If n is 2, clear entire screen (and moves cursor to upper left on DOS ANSI.SYS). If n is 3, clear entire screen and delete all lines saved in the scrollback buffer (this feature was added for xterm and is supported by other terminal applications).</td></tr><tr><td>CSI n K</td><td>EL – Erase in Line</td><td>Erases part of the line. If n is 0 (or missing), clear from cursor to the end of the line. If n is 1, clear from cursor to beginning of the line. If n is 2, clear entire line. Cursor position does not change.</td></tr><tr><td>CSI n S</td><td>SU – Scroll Up</td><td>Scroll whole page up by n (default 1) lines. New lines are added at the bottom. (not ANSI.SYS)</td></tr><tr><td>CSI n T</td><td>SD – Scroll Down</td><td>Scroll whole page down by n (default 1) lines. New lines are added at the top. (not ANSI.SYS)</td></tr><tr><td>CSI n ; m f</td><td>HVP – Horizontal Vertical Position</td><td>Same as CUP</td></tr><tr><td>CSI n m</td><td>SGR – Select Graphic Rendition</td><td>Sets the appearance of the following characters, see SGR parameters below.</td></tr><tr><td>CSI 5i</td><td>AUX Port On</td><td>Enable aux serial port usually for local serial printer</td></tr><tr><td>CSI 4i</td><td>AUX Port Off</td><td>Disable aux serial port usually for local serial printer</td></tr><tr><td>CSI 6n</td><td>DSR – Device Status Report</td><td>Reports the cursor position (CPR) to the application as (as though typed at the keyboard) ESC[n;mR, where n is the row and m is the column.)</td></tr><tr><td>CSI s</td><td>SCP – Save Cursor Position</td><td>Saves the cursor position/state.</td></tr><tr><td>CSI u</td><td>RCP – Restore Cursor Position</td><td>Restores the cursor position/state.</td></tr></tbody></table><h2 id=some-popular-private-sequences>Some popular private sequences</h2><table><thead><tr><th>Code</th><th>Effect</th></tr></thead><tbody><tr><td>CSI ? 25 h</td><td>DECTCEM Shows the cursor, from the VT320.</td></tr><tr><td>CSI ? 25 l</td><td>DECTCEM Hides the cursor.</td></tr><tr><td>CSI ? 1049 h</td><td>Enable alternative screen buffer</td></tr><tr><td>CSI ? 1049 l</td><td>Disable alternative screen buffer</td></tr><tr><td>CSI ? 2004 h</td><td>Turn on bracketed paste mode. Text pasted into the terminal will be surrounded by ESC [200~ and ESC [201~, and characters in it should not be treated as commands (for example in Vim).[20] From Unix terminal emulators.</td></tr><tr><td>CSI ? 2004 l</td><td>Turn off bracketed paste mode.</td></tr></tbody></table><h2 id=sgr-parameters>SGR parameters</h2><table><thead><tr><th>Code</th><th>Effect</th><th>Note</th></tr></thead><tbody><tr><td>0</td><td>Reset / Normal</td><td>all attributes off</td></tr><tr><td>1</td><td>Bold or increased intensity</td><td></td></tr><tr><td>2</td><td>Faint (decreased intensity)</td><td></td></tr><tr><td>3</td><td>Italic</td><td>Not widely supported. Sometimes treated as inverse.</td></tr><tr><td>4</td><td>Underline</td><td></td></tr><tr><td>5</td><td>Slow Blink</td><td>less than 150 per minute</td></tr><tr><td>6</td><td>Rapid Blink</td><td>MS-DOS ANSI.SYS; 150+ per minute; not widely supported</td></tr><tr><td>7</td><td>reverse video</td><td>swap foreground and background colors</td></tr><tr><td>8</td><td>Conceal</td><td>Not widely supported.</td></tr><tr><td>9</td><td>Crossed-out</td><td>Characters legible, but marked for deletion.</td></tr><tr><td>10</td><td>Primary(default) font</td><td></td></tr><tr><td>11–19</td><td>Alternative font</td><td>Select alternative font {\displaystyle n-10} {\displaystyle n-10}</td></tr><tr><td>20</td><td>Fraktur</td><td>Rarely supported</td></tr><tr><td>21</td><td>Doubly underline or Bold off</td><td>Double-underline per ECMA-48.[22] See discussion</td></tr><tr><td>22</td><td>Normal color or intensity</td><td>Neither bold nor faint</td></tr><tr><td>23</td><td>Not italic, not Fraktur</td><td></td></tr><tr><td>24</td><td>Underline off</td><td>Not singly or doubly underlined</td></tr><tr><td>25</td><td>Blink off</td><td></td></tr><tr><td>27</td><td>Inverse off</td><td></td></tr><tr><td>28</td><td>Reveal</td><td>conceal off</td></tr><tr><td>29</td><td>Not crossed out</td><td></td></tr><tr><td>30–37</td><td>Set foreground color</td><td>See color table below</td></tr><tr><td>38</td><td>Set foreground color</td><td>Next arguments are 5;n or 2;r;g;b, see below</td></tr><tr><td>39</td><td>Default foreground color</td><td>implementation defined (according to standard)</td></tr><tr><td>40–47</td><td>Set background color</td><td>See color table below</td></tr><tr><td>48</td><td>Set background color</td><td>Next arguments are 5;n or 2;r;g;b, see below</td></tr><tr><td>49</td><td>Default background color</td><td>implementation defined (according to standard)</td></tr><tr><td>51</td><td>Framed</td><td></td></tr><tr><td>52</td><td>Encircled</td><td></td></tr><tr><td>53</td><td>Overlined</td><td></td></tr><tr><td>54</td><td>Not framed or encircled</td><td></td></tr><tr><td>55</td><td>Not overlined</td><td></td></tr><tr><td>60</td><td>ideogram underline or right side line</td><td>Rarely supported</td></tr><tr><td>61</td><td>ideogram double underline or double line on the right side</td><td>Rarely supported</td></tr><tr><td>62</td><td>ideogram overline or left side line</td><td>Rarely supported</td></tr><tr><td>63</td><td>ideogram double overline or double line on the left side</td><td>Rarely supported</td></tr><tr><td>64</td><td>ideogram stress marking</td><td>Rarely supported</td></tr><tr><td>65</td><td>ideogram attributes off</td><td>reset the effects of all of 60–64</td></tr><tr><td>90–97</td><td>Set bright foreground color</td><td>aixterm (not in standard)</td></tr><tr><td>100–107</td><td>Set bright background color</td><td>aixterm (not in standard)</td></tr></tbody></table><h2 id=color-code>Color code</h2><table><thead><tr><th>Color</th><th>Foreground</th><th>Background</th></tr></thead><tbody><tr><td>Black</td><td>\u001b[30m</td><td>\u001b[40m</td></tr><tr><td>Red</td><td>\u001b[31m</td><td>\u001b[41m</td></tr><tr><td>Green</td><td>\u001b[32m</td><td>\u001b[42m</td></tr><tr><td>Yellow</td><td>\u001b[33m</td><td>\u001b[43m</td></tr><tr><td>Blue</td><td>\u001b[34m</td><td>\u001b[44m</td></tr><tr><td>Magenta</td><td>\u001b[35m</td><td>\u001b[45m</td></tr><tr><td>Cyan</td><td>\u001b[36m</td><td>\u001b[46m</td></tr><tr><td>White</td><td>\u001b[37m</td><td>\u001b[47m</td></tr><tr><td>Bright Black</td><td>\u001b[30;1m</td><td>\u001b[40;1m</td></tr><tr><td>Bright Red</td><td>\u001b[31;1m</td><td>\u001b[41;1m</td></tr><tr><td>Bright Green</td><td>\u001b[32;1m</td><td>\u001b[42;1m</td></tr><tr><td>Bright Yellow</td><td>\u001b[33;1m</td><td>\u001b[43;1m</td></tr><tr><td>Bright Blue</td><td>\u001b[34;1m</td><td>\u001b[44;1m</td></tr><tr><td>Bright Magenta</td><td>\u001b[35;1m</td><td>\u001b[45;1m</td></tr><tr><td>Bright Cyan</td><td>\u001b[36;1m</td><td>\u001b[46;1m</td></tr><tr><td>Bright White</td><td>\u001b[37;1m</td><td>\u001b[47;1m</td></tr><tr><td>Reset</td><td>\u001b[0m</td><td>\u001b[0m</td></tr></tbody></table><a href=https://peromage.github.io/p/ansi-escape-code-collection/>&nbsp;Read on &mldr;</a></div><div class=post><h1 class=post-title><a href=https://peromage.github.io/p/archive-multiboot-usb/>[Archive] Multiboot USB</a></h1><span class=post-date>Aug 27, 2023
&nbsp;&#183;&nbsp; 1 minute read
&nbsp;&#183;&nbsp;
<a class=label href=https://peromage.github.io/linux>linux</a></span><p>Boot from any ISO file</p><h2 id=hybrid-uefi-gpt-plus-bios-mbr-gpt-boot>Hybrid UEFI GPT + BIOS MBR/GPT boot</h2><h3 id=preparation>Preparation</h3><p>Create 3 partitions on a removable USB stick.</p><ol><li>A BIOS boot partition (gdisk type code <code>EF02</code>, or GUID <code>21686148-6449-6E6F-744E-656564454649</code>) with no filesystem. This partition can be put in any place on the disk but it is recommended to put it at the begginning from sector 34 to 2047. At minimal 1 MiB.</li><li>An EFI System partition (gdisk type code <code>EF00</code>) with a FAT32 filesystem. This partition can be as small as 50 MiB but it is better to set at least 256 MiB (550 MiB recommended).</li><li>Data partition (use a filesystem supported by GRUB). This partition can take up the rest of the space of the drive.</li></ol><h3 id=grub-installation>GRUB Installation</h3><p>Mount EFI and data partitions.
First install GRUB for UEFI:</p><a href=https://peromage.github.io/p/archive-multiboot-usb/>&nbsp;Read on &mldr;</a></div><div class=post><h1 class=post-title><a href=https://peromage.github.io/p/different-ways-to-write-a-major-mode/>Different Ways to Write a Major Mode</a></h1><span class=post-date>Mar 16, 2023
&nbsp;&#183;&nbsp; 3 minute read
&nbsp;&#183;&nbsp;
<a class=label href=https://peromage.github.io/emacs>emacs</a></span><p>This post mainly helps myself remember how to quickly write a major mode. My memory is getting worse. So sad. :(</p><h2 id=use-define-derived-mode>Use define-derived-mode</h2><p>Doc: <a href=https://www.gnu.org/software/emacs/manual/html_node/elisp/Derived-Modes.html>https://www.gnu.org/software/emacs/manual/html_node/elisp/Derived-Modes.html</a></p><p>This perhaps the most common way to write a major mode.</p><p>Most of the times I derive from <code>fundamental-mode</code>, or <code>nil</code> if the parent mode is not needed (a brand new mode).</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-elisp data-lang=elisp><span style=display:flex><span><span style=color:#8f5902;font-style:italic>;; With a parent mode</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87>define-derived-mode</span> <span style=color:#000>foo-mode</span> <span style=color:#000>fundamental-mode</span> <span style=color:#4e9a06>&#34;Foo&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>(</span><span style=color:#204a87>do</span> <span style=color:#000>something</span><span style=color:#000;font-weight:700>))</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>;; Or nothing</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87>define-derived-mode</span> <span style=color:#000>foo-mode</span> <span style=color:#000>nil</span> <span style=color:#4e9a06>&#34;Foo&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>(</span><span style=color:#204a87>do</span> <span style=color:#000>something</span><span style=color:#000;font-weight:700>))</span>
</span></span></code></pre></div><p>Here is the common pattern that I use. I use <code>:after-hook</code> keyword to run some additional setups after the major mode call. This is useful if some of the settings need to be overridden from the parent mode settings or its hooks.</p><a href=https://peromage.github.io/p/different-ways-to-write-a-major-mode/>&nbsp;Read on &mldr;</a></div><div class=post><h1 class=post-title><a href=https://peromage.github.io/p/lsp-setup-for-java/>LSP Setup for Java</a></h1><span class=post-date>Feb 18, 2023
&nbsp;&#183;&nbsp; 4 minute read
&nbsp;&#183;&nbsp;
<a class=label href=https://peromage.github.io/coding>coding</a></span><h2 id=update-on>Update on &lt;2023-06-07 Wed></h2><p>Found a much easier way to configure this and tried again with the update-to-date <code>lsp-java</code> and it worked magically. Can&rsquo;t recall why I had configuration issues before.</p><p>Simply it would be:</p><ol><li>Make sure JDK 17 is installed (According to the requirement of <code>lsp-java</code>).</li><li>Create a <code>lib</code> folder and put <code>.jar</code> files into it (or symlinks). See <a href=https://github.com/emacs-lsp/lsp-java/issues/226>this issue</a>.</li><li>Run <code>lsp-restart-workspace</code>.</li></ol><p>Voila! Now LSP works as you would expect :).</p><a href=https://peromage.github.io/p/lsp-setup-for-java/>&nbsp;Read on &mldr;</a></div><div class=post><h1 class=post-title><a href=https://peromage.github.io/p/file-based-blog-management-with-ox-hugo/>File-based Blog Management with ox-hugo</a></h1><span class=post-date>Nov 15, 2022
&nbsp;&#183;&nbsp; 2 minute read
&nbsp;&#183;&nbsp;
<a class=label href=https://peromage.github.io/emacs>emacs</a></span><h2 id=background>Background</h2><p>I previously wrote a <a href=/p/use-org-mode-to-manage-my-blog/>post</a> about managing blog posts with ox-hugo in org mode. I used to follow the recommendation to keep posts under org subtrees. As posts grew, I found that the opening speed is quite slow even I didn&rsquo;t have many pictures inserted. Although managing the entire site within one file does have some convenience, the slowness is something I can&rsquo;t bear.</p><p>Also I feel it a little awkward when I use the subtree style management. I always worried about if the format was correct like how many empty lines between posts or if something was accidentally changed outside of the post that I was editing. And in order to maintain the subtree structure, the actual posts have to be indented (nested), which is not what I like. There are solutions for this nested editing. I used to use <code>org-narrow-to-subtree</code> when I was editing the post and use <code>widen</code> to switch the view back. But still, I always worried about the format (please forgive OCD patient).</p><a href=https://peromage.github.io/p/file-based-blog-management-with-ox-hugo/>&nbsp;Read on &mldr;</a></div><div class=post><h1 class=post-title><a href=https://peromage.github.io/p/use-lisp-data-files-in-emacs/>Use lisp-data Files in Emacs</a></h1><span class=post-date>Nov 14, 2022
&nbsp;&#183;&nbsp; 2 minute read
&nbsp;&#183;&nbsp;
<a class=label href=https://peromage.github.io/emacs>emacs</a></span><p>I found that there were few posts mentioning about using <code>lisp-data</code> files. However, it seems to be used widely in various packages.</p><p><a href=https://www.gnu.org/software/emacs/manual/html_node/elisp/Read-and-Print.html>Emacs manumal</a> has a very detailed description of how to read and write lisp objects. In this post I&rsquo;ll mainly demonstrate one specific use case.</p><h2 id=read-from-file>Read from file</h2><p>The biggest challenge is to parse file content to Lisp lists. After a quick search with <code>describe-function</code>, <code>read</code> function is able to perfectly handle it in this case.</p><a href=https://peromage.github.io/p/use-lisp-data-files-in-emacs/>&nbsp;Read on &mldr;</a></div><div class=post><h1 class=post-title><a href=https://peromage.github.io/p/arch-linux-on-laptop/>Arch Linux on Laptop</a></h1><span class=post-date>Nov 8, 2022
&nbsp;&#183;&nbsp; 7 minute read
&nbsp;&#183;&nbsp;
<a class=label href=https://peromage.github.io/linux>linux</a></span><p>I recently got my new laptop and I found that some additional tweaks need to be made for laptops. Thus, this post is to have a record in case I forget when I have to reinstall the system.</p><h2 id=some-basic-setup>Some basic setup</h2><p>Unlike desktop, laptops have to be secure so encrytion is a must.</p><p>Details of how-to can be found on Arch wiki. I&rsquo;m not going to go through that here. However, I&rsquo;ll note down some considerations and things that need to pay attention to.</p><a href=https://peromage.github.io/p/arch-linux-on-laptop/>&nbsp;Read on &mldr;</a></div></div></div><script src=https://peromage.github.io/js/mathjax.3.2.2.tex-svg.min.js></script><div class=bottombar><div class=bottombar-sticky><div class=icons><span class=icons-item><a href=https://github.com/peromage target=_blank><i class="fab fa-github"></i></a> </span><span class=icons-item><a href=https://www.linkedin.com/in/fangdeng/ target=_blank><i class="fab fa-linkedin fa-1x"></i></a> </span><span class=icons-item><a href=mailto:fang@elfang.com><i class="fas fa-envelope fa-1x"></i></a> </span><span class=icons-item><a href=/me.pub><i class="fas fa-key fa-1x"></i></a></span></div><div class=footer><p>&copy; 2025 , <a href=https://peromage.github.io/license/>License</a><br><a href=/privacy title="Privacy notice">Privacy notice</a></p></div></div></div></body></html>