<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us><head><meta name=generator content="Hugo 0.146.5"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>undefined behavior &#183; </title><meta name=description content="Interesting content."><meta name=keywords content="Interesting keywords."><link rel=stylesheet href=https://peromage.github.io/css/skeria.css><link rel=stylesheet href=https://peromage.github.io/css/font.awesome.6.1.2.all.min.css></head><body><div class=topbar><div class=topbar-sticky><a href=https://peromage.github.io/ style=text-decoration:none><h1>undefined behavior</h1></a><span class=lead>tb;dr - too boring; don&rsquo;t read</span>
<span class=topbar-nav><p><span class=topbar-nav-item><a href=https://peromage.github.io/>Recent</a>
</span><span class=topbar-nav-item><a href=https://peromage.github.io/posts>All Posts</a>
</span><span class=topbar-nav-item><a href=https://peromage.github.io/categories>Categories</a>
</span><span class=topbar-nav-item><a href=https://peromage.github.io/tags>Tags</a>
</span><span class=topbar-nav-item><a href=https://peromage.github.io/about>About</a>
</span><span class=topbar-nav-item><a href=https://peromage.github.io/search>Search</a></span></p></span></div></div><div class="content container"><div class=posts><div class=post><h1 class=post-title><a href=https://peromage.github.io/p/windows-rescure-quick-reference/>Windows Rescure Quick Reference</a></h1><span class=post-date>Oct 19, 2022
&nbsp;&#183;&nbsp; 4 minute read
&nbsp;&#183;&nbsp;
<a class=label href=https://peromage.github.io/software>software</a></span><p>Though I&rsquo;ve written posts about <a href=/p/dual-booting-windows-vhd-and-native-linux-on-a-bios-gpt-pc/>dual-booting Windows and Linux</a> and <a href=/p/minimalists-multi-boot-usb-drive/>multi-booting a USB drive</a>, I have to go back and dig useful information out each time when I forget something.</p><p>After breaking my dual-boot setup once again (forgot to backup boot partition), I decided to create this post for a quick reference.</p><p>This reference assumes system is boot from UEFI and Windows is installed on a dedicated partition.</p><h2 id=setup-a-usb-with-system-images>Setup A USB With System Images</h2><p>Forget the previous multi-boot USB post. Use <a href=https://www.ventoy.net/en/index.html>Ventory</a> and it just works great.</p><a href=https://peromage.github.io/p/windows-rescure-quick-reference/>&nbsp;Read on &mldr;</a></div><div class=post><h1 class=post-title><a href=https://peromage.github.io/p/vnc-quick-guide/>VNC Quick Guide</a></h1><span class=post-date>Jun 15, 2022
&nbsp;&#183;&nbsp; 3 minute read
&nbsp;&#183;&nbsp;
<a class=label href=https://peromage.github.io/linux>linux</a></span><p>I found that every time when I try to setup VNC for remote access I always have troubles so this post serves as a note for myself.</p><p>Be aware VNC only works for X (not sure about Wayland).</p><h2 id=choose-a-vnc-server>Choose a VNC Server</h2><p>Generally I use <a href=https://tigervnc.org/>TigerVNC</a>. It&rsquo;s a fork of <em>TightVNC</em> with good performance and easy configuration.</p><p>It has two types of installations:</p><ul><li>Standalone: It creates a new X server when the client is connected. Independent from the local X server.</li><li>Scraping: It mirrors the local X server, like screen sharing.</li></ul><p>Usually they are shipped with individual packages. To install, for example, on Ubuntu</p><a href=https://peromage.github.io/p/vnc-quick-guide/>&nbsp;Read on &mldr;</a></div><div class=post><h1 class=post-title><a href=https://peromage.github.io/p/use-git-worktree-to-work-with-multiple-checkout-at-the-same-time/>Use Git Worktree to Work with Multiple Checkout at the Same Time</a></h1><span class=post-date>Jun 6, 2022
&nbsp;&#183;&nbsp; 1 minute read
&nbsp;&#183;&nbsp;
<a class=label href=https://peromage.github.io/coding>coding</a></span><h2 id=troubles>Troubles</h2><p>When working with a complicated project where you have to compare different history versions side by side, it soon becomes frustrating frequently checking out refs.</p><p>The old stupid way is to clone multiple repos and checkout to the specific revisions. When the project is big this might be a trouble because you&rsquo;re basically duplicating files.</p><h2 id=savior>Savior</h2><p>Git provides a convenience sub-command <code>worktree</code> to checkout a specific ref in another directory without duplicating files.</p><a href=https://peromage.github.io/p/use-git-worktree-to-work-with-multiple-checkout-at-the-same-time/>&nbsp;Read on &mldr;</a></div><div class=post><h1 class=post-title><a href=https://peromage.github.io/p/autoloading-in-emacs/>Autoloading in Emacs</a></h1><span class=post-date>Jun 6, 2022
&nbsp;&#183;&nbsp; 2 minute read
&nbsp;&#183;&nbsp;
<a class=label href=https://peromage.github.io/emacs>emacs</a></span><p>Autoloading is a neat feature in Emacs. It speeds up Emacs by lazy load the files. But it could be a little confusing if you&rsquo;re switching from Vim.</p><h2 id=myth-not-working-as-expected>Myth - Not Working as Expected</h2><p>If you have used Vim you know in Vim you can put your library files to the load path variable and Vim autoloads them whenever one of the functions/variables is used. Initially I thought this is the same in Emacs but with a little effort to put the magic autoload comments before the function/variable definition. It turned out I was wrong. When I called my functions Emacs could not find them until I explicitly require them. This is obviously not my intention.</p><a href=https://peromage.github.io/p/autoloading-in-emacs/>&nbsp;Read on &mldr;</a></div><div class=post><h1 class=post-title><a href=https://peromage.github.io/p/use-org-mode-to-manage-my-blog/>Use Org Mode to Manage My Blog</a></h1><span class=post-date>Jun 5, 2022
&nbsp;&#183;&nbsp; 6 minute read
&nbsp;&#183;&nbsp;
<a class=label href=https://peromage.github.io/emacs>emacs</a></span><p>I&rsquo;ve been using Emacs since last year but until recent I started using <code>org-mode</code> seriously. After spending a couple of days reading and watching all kinds of org tutorial as well as using it for documentation, I realized that people who invented this must geniuses.</p><p>Org document seems similar with Markdown: they are text markup format. However, Org provides far more capabilities to store metadata and greater editing experience together with Emacs&rsquo; <code>org-mode</code>.</p><a href=https://peromage.github.io/p/use-org-mode-to-manage-my-blog/>&nbsp;Read on &mldr;</a></div><div class=post><h1 class=post-title><a href=https://peromage.github.io/p/initialize-stdarray-at-compile-time/>Initialize std::array at Compile Time</a></h1><span class=post-date>Mar 16, 2022
&nbsp;&#183;&nbsp; 2 minute read
&nbsp;&#183;&nbsp;
<a class=label href=https://peromage.github.io/coding>coding</a></span><h2 id=background>Background</h2><p>I&rsquo;ve been working on optimization for some C++ code recently. One of the part is to initialize some data at compile time. Consider we have a C style enum definition:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#204a87;font-weight:700>typedef</span> <span style=color:#204a87;font-weight:700>enum</span> <span style=color:#000>Foo</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>AAA</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000>BBB</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000>CCC</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span> <span style=color:#000>Foo_t</span><span style=color:#000;font-weight:700>;</span>
</span></span></code></pre></div><p>We want to have an array of the enum with undefined initial values <code>999</code> because by default initialization the values would be <code>0</code>&rsquo;s. However, <code>std::array</code> can only be initialized by initializer list, which is said:</p><a href=https://peromage.github.io/p/initialize-stdarray-at-compile-time/>&nbsp;Read on &mldr;</a></div><div class=post><h1 class=post-title><a href=https://peromage.github.io/p/my-common-windows-vm-setup/>My Common Windows VM Setup</a></h1><span class=post-date>Mar 13, 2022
&nbsp;&#183;&nbsp; 15 minute read
&nbsp;&#183;&nbsp;
<a class=label href=https://peromage.github.io/linux>linux</a></span><h2 id=before-starting>Before Starting</h2><p>This post mainly discusses VM setup for Windows since I&rsquo;ve been using Windows as a secondary OS for apps or games that cannot run on Linux.</p><p>This post discusses setup on Arch Linux.</p><p>This post assumes the CPU and motherboard support <code>VT-d</code> and <code>IOMMU</code> features. Detailed prerequisites can be found on <a href=https://wiki.archlinux.org/title/PCI_passthrough_via_OVMF>this page</a>.</p><h2 id=install-hypervisor>Install Hypervisor</h2><p>Follow Arch wiki to install and setup:</p><ol><li><a href=https://wiki.archlinux.org/title/QEMU>QEMU</a></li><li><a href=https://wiki.archlinux.org/title/libvirt>Libvirt</a></li><li><a href=https://wiki.archlinux.org/title/Virt-Manager>Virt-Manager</a></li><li><a href=https://wiki.archlinux.org/title/PCI_passthrough_via_OVMF>OVMF</a></li></ol><h2 id=install-windows-vm>Install Windows VM</h2><h3 id=before-installation>Before Installation</h3><p>Download the latest Windows 10 ISO from <a href=https://www.microsoft.com/en-ca/software-download/windows10ISO>Microsoft</a>. Windows 11 is buggy and requires Microsoft account login during installation, which sucks.</p><a href=https://peromage.github.io/p/my-common-windows-vm-setup/>&nbsp;Read on &mldr;</a></div><div class=post><h1 class=post-title><a href=https://peromage.github.io/p/fix-metadata-in-google-photo-takeout/>Fix Metadata in Google Photo Takeout</a></h1><span class=post-date>Mar 13, 2022
&nbsp;&#183;&nbsp; 1 minute read
&nbsp;&#183;&nbsp;
<a class=label href=https://peromage.github.io/software>software</a></span><p>Google Photo sucks.</p><h2 id=troubles>Troubles</h2><p>When exporting photos from Google Photo, a bunch of JSON files come with your photos. Those JSON files contain metadata which is supposed to be stored with your photo files. If you simple import those photo files into another photo manager you will most likely not get a chronological view. Obviously, Google does on purpose so that you will not leave it easily.
However, there is a workaround that is able to merge those metadata into your photos.</p><a href=https://peromage.github.io/p/fix-metadata-in-google-photo-takeout/>&nbsp;Read on &mldr;</a></div><div class=post><h1 class=post-title><a href=https://peromage.github.io/p/shadowsocks-quick-setup/>Shadowsocks Quick Setup</a></h1><span class=post-date>Mar 13, 2022
&nbsp;&#183;&nbsp; 2 minute read
&nbsp;&#183;&nbsp;
<a class=label href=https://peromage.github.io/linux>linux</a></span><p>This note is written for my personal convenience.</p><h2 id=server-setup>Server Setup</h2><h3 id=installation>Installation</h3><p>Use system package manager to install <code>shadowsocks-libev</code>. In this case, for Arch Linux it is <code>pacman</code>.</p><p>There is also a Python package which can be installed by <code>pip</code> but it seems not to be maintained for a long time.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ sudo pacman -S shadowsocks-libev
</span></span></code></pre></div><h3 id=shadowsocks-server-configuration>Shadowsocks Server Configuration</h3><p>Config file is located at <code>/etc/shadowsocks/myserver.json</code>. On FreeBSD it is <code>/usr/local/etc/shadowsocks/myserver.json</code></p><p>The file name can vary.</p><a href=https://peromage.github.io/p/shadowsocks-quick-setup/>&nbsp;Read on &mldr;</a></div><div class=post><h1 class=post-title><a href=https://peromage.github.io/p/ssh-over-gpg-agent/>SSH Over GPG Agent</a></h1><span class=post-date>Mar 13, 2022
&nbsp;&#183;&nbsp; 1 minute read
&nbsp;&#183;&nbsp;
<a class=label href=https://peromage.github.io/linux>linux</a></span><p>This is a quick note of <code>gpg-agent</code> setup for SSH.</p><h2 id=quick-setup>Quick Setup</h2><ol><li>Import your GPG authentication key.</li><li>Enable SSH support for <code>gpg-agent</code>.</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ <span style=color:#204a87>echo</span> enable-ssh-support &gt;&gt; <span style=color:#000>$HOME</span>/.gnupg/gpg-agent.conf
</span></span></code></pre></div><ol><li>Get the authentication keygrip.</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ gpg -k --with-keygrip
</span></span></code></pre></div><ol><li>Add the authentication key to the keychain (replace <code>KEYGRIP</code> with the value obtained from the previous step)</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ <span style=color:#204a87>echo</span> KEYGRIP &gt;&gt; <span style=color:#000>$HOME</span>/.gnupg/sshcontrol
</span></span></code></pre></div><ol><li>Add the following init code to <code>.bashrc</code></li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#204a87>unset</span> SSH_AGENT_PID
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>SSH_AUTH_SOCK</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;</span><span style=color:#204a87;font-weight:700>$(</span>gpgconf --list-dirs agent-ssh-socket<span style=color:#204a87;font-weight:700>)</span><span style=color:#4e9a06>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>GPG_TTY</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;</span><span style=color:#204a87;font-weight:700>$(</span>tty<span style=color:#204a87;font-weight:700>)</span><span style=color:#4e9a06>&#34;</span>
</span></span><span style=display:flex><span>gpg-connect-agent updatestartuptty /bye &gt; /dev/null
</span></span></code></pre></div><ol><li>Kill any running <code>ssh-agent</code> and <code>gpg-agent</code>, and then open a new Bash session.</li></ol><h2 id=misc>Misc</h2><h3 id=export-ssh-public-keys>Export SSH Public Keys</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ gpg --export-ssh-key &lt;uid/fingerprint&gt;
</span></span></code></pre></div><a href=https://peromage.github.io/p/ssh-over-gpg-agent/>&nbsp;Read on &mldr;</a></div></div></div><script src=https://peromage.github.io/js/mathjax.3.2.2.tex-svg.min.js></script><div class=bottombar><div class=bottombar-sticky><div class=icons><span class=icons-item><a href=https://github.com/peromage target=_blank><i class="fab fa-github"></i></a> </span><span class=icons-item><a href=https://www.linkedin.com/in/fangdeng/ target=_blank><i class="fab fa-linkedin fa-1x"></i></a> </span><span class=icons-item><a href=mailto:fang@elfang.com><i class="fas fa-envelope fa-1x"></i></a> </span><span class=icons-item><a href=/me.pub><i class="fas fa-key fa-1x"></i></a></span></div><div class=footer><p>&copy; 2025 , <a href=https://peromage.github.io/license/>License</a><br><a href=/privacy title="Privacy notice">Privacy notice</a></p></div></div></div></body></html>